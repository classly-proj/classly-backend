Test

<script>

    function creds() {
        const username = prompt("Enter username");
        const password = prompt("Enter password");

        return { username, password };
    }

    async function createAccount() {
        const res = await fetch("/user/create", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify(creds())
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true,
            user: await res.json()
        };
    }

    async function login() {
        const res = await fetch("/user/login", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify(creds())
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true
        };
    }

    async function getUsers() {
        const res = await fetch("/user/all", {
            method: "GET",
            headers: {
                "Content-Type": "text/plain"
            }
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true,
            users: await res.json()
        };
    }

    async function deleteUser() {
        const res = await fetch("/user/delete", {
            method: "DELETE"
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true
        };
    }

    async function getUser() {
        const res = await fetch("/user/get", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify({
                username: prompt("Enter username")
            })
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true,
            user: await res.json()
        };
    }
</script>

<script>
    async function getCourseCRNS() {
        const res = await fetch("/course/all");

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true,
            crns: await res.json()
        };
    }

    async function getCourse() {
        const res = await fetch("/course/get", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify({
                crn: prompt("Enter CRN")
            })
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true,
            course: await res.json()
        };
    }

    async function getCourseBySubject() {
        const res = await fetch("/course/subject", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify({
                subject_code: prompt("Enter subject")
            })
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true,
            courses: await res.json()
        };
    }

    async function search() {
        const res = await fetch("/course/query/list");

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        // Internal Key -> Display Name
        const queriableTypes = await res.json();

        const box = document.createElement("div");
        box.style.position = "absolute";
        box.style.top = "50%";
        box.style.left = "50%";
        box.style.transform = "translate(-50%, -50%)";
        box.style.backgroundColor = "grey";

        const select = document.createElement("select");
        select.style.width = "200px";
        select.style.height = "30px";
        select.style.fontSize = "20px";

        for (const [key, value] of Object.entries(queriableTypes)) {
            const option = document.createElement("option");
            option.value = key;
            option.innerText = value;

            select.appendChild(option);
        }

        box.appendChild(select);

        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Search";
        input.style.width = "200px";
        input.style.height = "30px";
        input.style.fontSize = "20px";

        box.appendChild(input);

        let lastChange = null;

        let searchKey = null;

        async function searchTick() {
            if (input.value === lastChange || input.value.length < 3) {
                setTimeout(searchTick, 100);
                return;
            }

            searchKey = select.value;

            lastChange = input.value;

            let searchValue = lastChange;

            if (searchKey === "subject-number") {
                // Grep a string any number of whitespace, and a number
                const match = lastChange.match(/([a-zA-Z]+)\s*(\d+)/);

                if (match) {
                    searchValue = `${match[1].toUpperCase()}-${match[2]}`;
                } else {
                    setTimeout(searchTick, 100);
                    return;
                }
            }


            const response = await fetch("/course/query", {
                method: "POST",
                headers: {
                    "Content-Type": "text/plain"
                },
                body: JSON.stringify({ key: searchKey, value: searchValue })
            });

            if (response.status !== 200) {
                return {
                    ok: false,
                    status: response.status
                };
            }

            const courses = await response.json();
            window.latestCourses = courses;
            console.log(courses);

            setTimeout(searchTick, 100);
        }

        searchTick();

        document.body.appendChild(box);
    }

    async function addCourses(...crns) {
        const res = await fetch("/user/addclass", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify(crns)
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true
        };
    }

    async function removeCourses(...crns) {
        const res = await fetch("/user/removeclass", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain"
            },
            body: JSON.stringify(crns)
        });

        if (res.status !== 200) {
            return {
                ok: false,
                status: res.status
            };
        }

        return {
            ok: true
        };
    }

    const API_HOST = {
        "127.0.0.1": "http://127.0.0.1:8000",
        "localhost": "http://localhost:8000",
        "hacknhbackend": "https://hacknhbackend.herokuapp.com"
    }[window.location.hostname] || "http://localhost:8000";

</script>